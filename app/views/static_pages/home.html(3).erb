<% provide(:title, 'Home') %>
<div class="center jumbotron">
  <h1>ようこそ！タイピングゲームのページへ！</h1>
</div>

<div class="comment">
  このページでは昔のゲームのタイトルを使ってタイピングゲームをする事が出来ます。<br>
  ハイスコアネームを残したい方はアカウントを作成しログインしていれば、ゲーム終了後<br>
  高得点を取ることによりハイスコアネームを残せますので、宜しければアカウント作成の上<br>
  ゲームをプレイしてみてください！<br>
  アカウント作成は<a herf="http://static_pages/authentication/">こちら</a>から<br><br>

  また、既にアカウントを作成されている方はヘッダーのテキストボックスからIDとPASSWORDを<br>
  入力してください。
</div>

<!--キーボード入力-->
<script>

    var timer1;//タイマーを格納する変数

    window.document.onkeydown = typeGame;//キーを押したら関数typeGame()を呼び出す

    //キーコードを格納する配列
    var keycode = new Array(13, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,
        78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90);

    //グローバル変数
    var correct_count = 0;    //正しく打てた文字数
    var mistake_count = 0;    //間違えた文字数
    var combo_count = 0;    //コンボ数(文字列を間違えず打ち切ると1、2と増加、間違えたら0に戻る)
    var maxcombo_count = 0;    //最大コンボ数

    //カウントダウン関数を1000ミリ毎に呼び出す関数
    function cntStart() {
        document.timer.elements[1].disabled = true;
        timer1 = setInterval("countDown()", 1000);
    }

    //タイマー停止関数
    function cntStop() {
        document.timer.elements[1].disabled = false;
        clearInterval(timer1);
    }

    //カウントダウン関数
    function countDown() {
        var sec = document.timer.elements[0].value;

        if (sec == "") {
            alert("時刻を設定してください！");
            reSet();
        }
        else {

            if (sec == "") sec = 0;
            sec = parseInt(sec);

            tmWrite(sec - 1);
        }
    }

    //残り時間を書き出す関数
    function tmWrite(int) {
        int = parseInt(int);

        if (int <= 0) {
            reSet();
            alert("時間です！");
        }
        else {
            //残り秒数はintを60で割った余り
            document.timer.elements[0].value = int % 60;
            document.getElementById("timercount").innerHTML = document.timer.elements[0].value;
        }
    }

    //フォームを初期状態に戻す(リセット)関数
    function reSet() {
        document.timer.elements[0].value = "0";
        document.timer.elements[1].disabled = false;
        clearInterval(timer1);
    }

    // //キー入力を受け取る関数
    // function typeGame(evt)
    // {
    //     var kc; //入力されたキーコードを格納する変数
    //
    //     //入力されたキーのキーコードを取得
    //     if(document.all)
    //     {
    //         kc = event.keyCode;
    //     }
    //     else
    //     {
    //         kc = evt.which;
    //     }
    //     //入力されたキーコードと問題文のキーコードを比較 ※問題の文字列と比較する予定keycode[[]]、一旦[a]=65でテスト
    //     if (kc == 65) {
    //         //入力されたセルの文字色を灰色にする
    //         var idName = "word" + cnt;
    //         document.getElementById(idName).style.color = "#808080";
    //         cnt++; //文字列を1つ進める
    //     }
    //     else {
    //         //入力されたセルの文字色を赤にしてやり直し
    //         var idName = "word" + cnt;
    //         document.getElementById(idName).style.color = "#FF0000";
    //     }
    //
    //     //全文字入力したか確認
    //     if (cnt == )
    //     {
    //
    //     }
    //
    //     //残り時間が0になったらゲーム画面にGAME OVERの文字を出力する
    //     if (document.timer.elements[0].value == 0)
    //     {
    //         var fin="TIME OVER";
    //         document.getElementById("waku").innerHTML = fin;
    //     }
    // }
</script>


  <%= javascript_tag do %>
    var n=0;
    window.questions = <%= raw @questions.to_json %>;
    console.log("test"+window.questions[n].character_string);

    window.document.onkeydown = function(event){
    if (event.key === 'Enter')
    { console.log('hello Enter')
    var a = Math.random() * 3;
    var n = Math.floor( a ) + 1;
    $("#title_img").attr("src", window.questions[n].image_path);
    var newText = window.questions[n].character_string;
    $("#string").text(newText);
      }
    }
  <% end %>


<div class="pattern1">
  <form name="timer">
    <input type="text" value="30">秒<br>
    <input type="button" value="start" onclick="cntStart()">
    <input type="button" value="stop" onclick="cntStop()">
  </form>

  <div class="moji">
    <%= image_tag("title.jpg", :id => "title_img") %>
    <div class="timer" id="timercount"></div>
    <p id="string">PUSH ENTER KEY</p>
  </div>

<div id="waku"></div>
  <!--<button type="submit" class="btn btn-default" button id="button1" onclick="test()">Push</button>-->
</div>
<p>Find me in app/views/static_pages/home.html.erb</p>